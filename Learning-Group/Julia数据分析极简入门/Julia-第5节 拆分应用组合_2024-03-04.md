# Julia数据分析极简入门


## 第5节 分拆-应用-组合（Split-Apply-Combine）

许多数据分析任务包括三个步骤:
1、将数据集分组；
2、对每个组应用一些函数；
3、并将结果组合。

注意，任何这个通用过程中的第1步和第3步都可以省略，在这种情况下，我们只转换一个数据框，而不对其进行分组，然后合并结果。

Hadley Wickham撰写的论文[《数据分析的拆分-应用-组合策略》](http://www.jstatsoft.org/v40/i01)中描述了处理这类计算的标准化框架。

DataFrames包支持拆分-应用-组合策略，通过`groupby`函数创建`GroupedDataFrame`，然后是`combine`，`select `/ `select!`或`transform`/`transform!`。

手册这一部分中描述的所有操作都支持`AbstractDataFrame`(当拆分和合并步骤被跳过时)和`GroupedDataFrame`。从技术上讲，`AbstractDataFrame`只是被认为是在没有列的情况下分组(意味着它只有一个组，如果为空则为零组)。唯一的区别是，在这种情况下，`keepkeys`和`ungroup`关键字参数不受支持，并且总是返回数据框，因为在这种情况下没有分割和合并步骤。

为了按组执行操作，首先需要使用`groupby`函数从数据帧中创建一个`GroupedDataFrame`对象，该函数接受两个参数:(1)要分组的数据帧，以及(2)要分组的列集。

然后可以使用以下函数之一对每个组应用操作:
* `combine`: 不限制返回的行数，行的顺序由' GroupedDataFrame '中的组的顺序指定;它通常用于按组计算汇总统计信息;
* `select`: 返回一个数据帧，其行数和顺序与源数据帧完全相同，只包括新的计算列;“选择!'是' select '的就地版本;
* `transform`: 返回一个行数和行序与源数据帧完全相同的数据帧，包括源数据帧中的所有列和新的计算列;“变换!'是' transform '的就地版本。

所有这些函数都有一个或多个函数的规范，应用于“DataFrame”的每个子集。本规范可以有以下几种形式:

1. 标准列选择器(整数，' Symbol ' s，字符串，整数向量，' Symbol ' s向量，字符串向量，' All '， ' Cols '， ': '， ' Between '， ' Not '和正则表达式)

2. 一个' cols =>函数'对，指示' function '应该使用包含列' cols '的位置参数来调用，它可以是任何有效的列选择器;在这种情况下，目标列名是自动生成的，并且假设' function '返回单个值或一个向量;默认情况下，生成的名称是通过连接源列名和'函数'名来创建的(参见下面的示例)。

3. 一个' cols => function => target_cols '形式额外显式指定目标列或多个列，必须是单个名称(作为' Symbol '或字符串)，名称的向量或' AsTable '。此外，它可以是一个“Function”，它接受一个字符串或字符串向量作为参数，包含' cols '选择的列的名称，并返回目标列的名称(除了' AsTable '外，所有接受的类型都是允许的)。

4.  一个' col => target_cols '对，它将列' col '重命名为' target_cols '，它必须是单个名称(作为' Symbol '或字符串)，一个名称或' AsTable '的向量。
5. 特殊的方便形式' function => target_cols '或只是' function '特定的'函数'，其中输入列被省略;如果没有' target_cols '，新列的名称与' function '相同，否则它必须是单个名称(作为' Symbol '或字符串)。支持的'函数是:
* ' nrow '以有效地计算每个组中的行数。
* ' proprow '来有效地计算每个组中的行比例。
* ' eachindex '返回一个包含每个组中每行数的向量。
* ' groupindices '返回组号。

6. 包含由第2点到第5点所述的“Pair”语法指定的变换的向量或矩阵
   
7. 如果处理了“GroupedDataFrame”，则调用对应于每个组的“SubDataFrame”函数;如果处理了“AbstractDataFrame”，则调用数据帧本身;这种形式应该避免，因为它的性能很差，除非组的数量很少或处理的列非常多(在这种情况下，' SubDataFrame '避免过度编译)。


注意!如果传递' x => y '形式的表达式，那么除了' nrow => target_cols '特殊方便的形式外，它总是被解释为' cols => function '。特别是下面的表达式' function => target_cols '不是一个有效的转换规范。


注意!如果' cols '或' target_cols '是' All '、' cols '、' Between '或' Not '中的一个，则使用'。支持=> '，等价于广播' names(df, cols) '或' names(df, target_cols) '的结果。这就像在数据帧范围内用选定的列名替换选择器后发生了广播一样。



所有函数都有两种类型的签名。其中一个将“GroupedDataFrame”作为第一个参数，并将上面描述的任意数量的转换作为下面的参数。第二种类型的签名是当“Function”或“type”作为第一个参数传递，“GroupedDataFrame”作为第二个参数传递时(类似于“map”)。


作为一个特殊规则，使用' cols =>函数'和' cols =>函数=> target_cols '语法，如果' cols '被包装在' AsTable '对象中，则' NamedTuple '包含' cols '选择的列将被传递给' function '。


' function '允许返回的值由' target_cols '值决定:


1. 如果' cols '和' target_cols '都被省略了(所以只传递了一个' function ')，那么返回一个数据帧、一个矩阵、一个' NamedTuple '或一个' DataFrameRow '将在结果中产生多个列。返回任何其他值将生成一个单列。

2. 如果' target_cols '是一个' Symbol '或一个字符串，则该函数将返回一个单列。在这种情况下，返回一个数据帧、一个矩阵、一个“NamedTuple”或一个“DataFrameRow”将引发错误。

3. 如果' target_cols '是' Symbol '或' strings '或' AsTable '的向量，则假定' function '返回多个列。如果' function '返回' AbstractDataFrame '， ' NamedTuple '， ' DataFrameRow '， ' AbstractMatrix '中的一个，那么上述第1点中描述的规则将适用。如果' function '返回一个' AbstractVector '，那么这个vector的每个元素必须支持' keys '函数，该函数必须返回一个' Symbol '，字符串或整数的集合;' keys '的返回值必须对所有元素相同。然后，' keys '函数的返回值中有多少元素，就创建多少列。如果' target_cols '是' AsTable '，则它们的名称将被设置为与键名相等，除非' keys '返回整数，在这种情况下，它们以' x '为前缀(因此列名为例如。' x1 '， ' x2 '，…)。如果' target_cols '是' Symbol '或字符串的向量，则使用上述规则生成的列名将被忽略，并被' target_cols '取代(在这种情况下，列的数量必须与' target_cols '的长度相同)。如果' fun '返回任何其他类型的值，则假定它是符合Tables的表。jl API和“表”。调用Columntable '函数来获取结果列及其名称。当' target_cols '为' AsTable '时，名称将被保留，如果' target_cols '是' Symbol '或字符串的向量，则名称将被替换。

在所有这些情况下，' function '可以返回单行或多行。作为一个特殊的规则，在' Ref '或' 0 '维' AbstractArray '中包装的值将被解包装，然后作为一行处理。

“选择”/“选择!'和' transform ' / ' transform!'总是返回一个与源数据具有相同数量和行顺序的数据帧(即使' GroupedDataFrame '重新排序了它的组)，除非选择结果在结果数据帧中为零列(在这种情况下，结果为零行)。

对于' combine '，返回对象中的行按照' GroupedDataFrame '中的组的顺序出现。函数可以为每个组返回任意数量的行，但是对于所有组，返回的对象类型以及列的数量和名称必须相同，除非返回' DataFrame() '或' NamedTuple() '，在这种情况下，给定的组将被跳过。

如果需要进行多个转换，则允许混合使用单个值和向量。在这种情况下，单个值将被重复，以匹配由返回向量指定的列的长度。

默认情况下(' threads=true ')为每个指定的转换派生一个单独的任务;然后，每个转换生成与Julia线程一样多的任务，并在它们之间分割组的处理(然而，目前具有优化实现的转换，如“sum”和返回多行的转换，对所有组使用单个任务)。当Julia启动时有多个线程时，这允许并行操作。传递的转换函数因此不能修改全局变量(即它们必须是纯的)，使用锁来控制并行访问，或者必须传递' threads=false '来禁用多线程。

要将' function '应用于每一行而不是整个列，可以将它包装在' ByRow '结构体中。' cols '可以是任何列索引语法，在这种情况下，' function '将为' cols '指定的每一列传递一个参数，如果指定的列被' AsTable '包装，则为它们传递一个' NamedTuple '。如果使用' ByRow '，则允许' cols '选择一个空列集，在这种情况下，' function '为每一行调用，不带任何参数，如果空列集被' AsTable '包装，则传递一个空' NamedTuple '。

转换函数支持以下关键字参数(并非在所有情况下都支持所有关键字参数;一般来说，在有意义的情况下允许使用它们，详细信息请参阅特定函数的文档):
  
  —“keepkeys”:是否在返回的数据帧中保留分组列。
  - ' ungroup ':操作的返回值是数据帧还是' GroupedDataFrame '。
  - ' copycols ':如果没有对源数据帧的列应用转换，是否应该复制它们。
  - ' renamecols ':无论在' cols => function '表单中自动生成的列名是否包含转换函数的名称。
  -“线程”:转换是否可以在独立的任务中运行，这些任务可以并行执行

下面我们将展示几个应用于“虹膜”数据集的函数示例:


```julia
using DataFrames, CSV, Statistics
iris = CSV.read((joinpath(dirname(pathof(DataFrames)),"..", "docs", "src", "assets", "iris.csv")),DataFrame)
```




<table class="data-frame"><thead><tr><th></th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><p>150 rows × 5 columns</p><tr><th>1</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>2</th><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>3</th><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>4</th><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>5</th><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>6</th><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>7</th><td>4.6</td><td>3.4</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>8</th><td>5.0</td><td>3.4</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>9</th><td>4.4</td><td>2.9</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>10</th><td>4.9</td><td>3.1</td><td>1.5</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>11</th><td>5.4</td><td>3.7</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>12</th><td>4.8</td><td>3.4</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>13</th><td>4.8</td><td>3.0</td><td>1.4</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>14</th><td>4.3</td><td>3.0</td><td>1.1</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>15</th><td>5.8</td><td>4.0</td><td>1.2</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>16</th><td>5.7</td><td>4.4</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>17</th><td>5.4</td><td>3.9</td><td>1.3</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>18</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>19</th><td>5.7</td><td>3.8</td><td>1.7</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>20</th><td>5.1</td><td>3.8</td><td>1.5</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>21</th><td>5.4</td><td>3.4</td><td>1.7</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>22</th><td>5.1</td><td>3.7</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>23</th><td>4.6</td><td>3.6</td><td>1.0</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>24</th><td>5.1</td><td>3.3</td><td>1.7</td><td>0.5</td><td>Iris-setosa</td></tr><tr><th>25</th><td>4.8</td><td>3.4</td><td>1.9</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>26</th><td>5.0</td><td>3.0</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>27</th><td>5.0</td><td>3.4</td><td>1.6</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>28</th><td>5.2</td><td>3.5</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>29</th><td>5.2</td><td>3.4</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>30</th><td>4.7</td><td>3.2</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>




```julia
gdf = groupby(iris, :Species)
```




<p><b>GroupedDataFrame with 3 groups based on key: Species</b></p><p><i>First Group (50 rows): Species = "Iris-setosa"</i></p><table class="data-frame"><thead><tr><th></th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><tr><th>1</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>2</th><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>3</th><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>4</th><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>5</th><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>6</th><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>7</th><td>4.6</td><td>3.4</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>8</th><td>5.0</td><td>3.4</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>9</th><td>4.4</td><td>2.9</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>10</th><td>4.9</td><td>3.1</td><td>1.5</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>11</th><td>5.4</td><td>3.7</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>12</th><td>4.8</td><td>3.4</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>13</th><td>4.8</td><td>3.0</td><td>1.4</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>14</th><td>4.3</td><td>3.0</td><td>1.1</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>15</th><td>5.8</td><td>4.0</td><td>1.2</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>16</th><td>5.7</td><td>4.4</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>17</th><td>5.4</td><td>3.9</td><td>1.3</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>18</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>19</th><td>5.7</td><td>3.8</td><td>1.7</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>20</th><td>5.1</td><td>3.8</td><td>1.5</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>21</th><td>5.4</td><td>3.4</td><td>1.7</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>22</th><td>5.1</td><td>3.7</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>23</th><td>4.6</td><td>3.6</td><td>1.0</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>24</th><td>5.1</td><td>3.3</td><td>1.7</td><td>0.5</td><td>Iris-setosa</td></tr><tr><th>25</th><td>4.8</td><td>3.4</td><td>1.9</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>26</th><td>5.0</td><td>3.0</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>27</th><td>5.0</td><td>3.4</td><td>1.6</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>28</th><td>5.2</td><td>3.5</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>29</th><td>5.2</td><td>3.4</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>30</th><td>4.7</td><td>3.2</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (50 rows): Species = "Iris-virginica"</i></p><table class="data-frame"><thead><tr><th></th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><tr><th>1</th><td>6.3</td><td>3.3</td><td>6.0</td><td>2.5</td><td>Iris-virginica</td></tr><tr><th>2</th><td>5.8</td><td>2.7</td><td>5.1</td><td>1.9</td><td>Iris-virginica</td></tr><tr><th>3</th><td>7.1</td><td>3.0</td><td>5.9</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>4</th><td>6.3</td><td>2.9</td><td>5.6</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>5</th><td>6.5</td><td>3.0</td><td>5.8</td><td>2.2</td><td>Iris-virginica</td></tr><tr><th>6</th><td>7.6</td><td>3.0</td><td>6.6</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>7</th><td>4.9</td><td>2.5</td><td>4.5</td><td>1.7</td><td>Iris-virginica</td></tr><tr><th>8</th><td>7.3</td><td>2.9</td><td>6.3</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>9</th><td>6.7</td><td>2.5</td><td>5.8</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>10</th><td>7.2</td><td>3.6</td><td>6.1</td><td>2.5</td><td>Iris-virginica</td></tr><tr><th>11</th><td>6.5</td><td>3.2</td><td>5.1</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>12</th><td>6.4</td><td>2.7</td><td>5.3</td><td>1.9</td><td>Iris-virginica</td></tr><tr><th>13</th><td>6.8</td><td>3.0</td><td>5.5</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>14</th><td>5.7</td><td>2.5</td><td>5.0</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>15</th><td>5.8</td><td>2.8</td><td>5.1</td><td>2.4</td><td>Iris-virginica</td></tr><tr><th>16</th><td>6.4</td><td>3.2</td><td>5.3</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>17</th><td>6.5</td><td>3.0</td><td>5.5</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>18</th><td>7.7</td><td>3.8</td><td>6.7</td><td>2.2</td><td>Iris-virginica</td></tr><tr><th>19</th><td>7.7</td><td>2.6</td><td>6.9</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>20</th><td>6.0</td><td>2.2</td><td>5.0</td><td>1.5</td><td>Iris-virginica</td></tr><tr><th>21</th><td>6.9</td><td>3.2</td><td>5.7</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>22</th><td>5.6</td><td>2.8</td><td>4.9</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>23</th><td>7.7</td><td>2.8</td><td>6.7</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>24</th><td>6.3</td><td>2.7</td><td>4.9</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>25</th><td>6.7</td><td>3.3</td><td>5.7</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>26</th><td>7.2</td><td>3.2</td><td>6.0</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>27</th><td>6.2</td><td>2.8</td><td>4.8</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>28</th><td>6.1</td><td>3.0</td><td>4.9</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>29</th><td>6.4</td><td>2.8</td><td>5.6</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>30</th><td>7.2</td><td>3.0</td><td>5.8</td><td>1.6</td><td>Iris-virginica</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>




```julia
combine(gdf, :PetalLength => mean)
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>PetalLength_mean</th></tr><tr><th></th><th>String15</th><th>Float64</th></tr></thead><tbody><p>3 rows × 2 columns</p><tr><th>1</th><td>Iris-setosa</td><td>1.464</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>4.26</td></tr><tr><th>3</th><td>Iris-virginica</td><td>5.552</td></tr></tbody></table>




```julia
combine(gdf, nrow, :PetalLength => mean => :mean)
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>nrow</th><th>mean</th></tr><tr><th></th><th>String15</th><th>Int64</th><th>Float64</th></tr></thead><tbody><p>3 rows × 3 columns</p><tr><th>1</th><td>Iris-setosa</td><td>50</td><td>1.464</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>50</td><td>4.26</td></tr><tr><th>3</th><td>Iris-virginica</td><td>50</td><td>5.552</td></tr></tbody></table>




```julia
# combine(gdf, [:PetalLength, :SepalLength] => ((p, s) -> (a=mean(p)/mean(s), b=sum(p))) => AsTable) # multiple columns are passed as arguments
```


```julia
combine(gdf,   AsTable([:PetalLength, :SepalLength]) =>
               x -> std(x.PetalLength) / std(x.SepalLength)) # passing a NamedTuple
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>PetalLength_SepalLength_function</th></tr><tr><th></th><th>String15</th><th>Float64</th></tr></thead><tbody><p>3 rows × 2 columns</p><tr><th>1</th><td>Iris-setosa</td><td>0.492245</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>0.910378</td></tr><tr><th>3</th><td>Iris-virginica</td><td>0.867923</td></tr></tbody></table>




```julia
combine(x -> std(x.PetalLength) / std(x.SepalLength), gdf) # passing a SubDataFrame
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>x1</th></tr><tr><th></th><th>String15</th><th>Float64</th></tr></thead><tbody><p>3 rows × 2 columns</p><tr><th>1</th><td>Iris-setosa</td><td>0.492245</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>0.910378</td></tr><tr><th>3</th><td>Iris-virginica</td><td>0.867923</td></tr></tbody></table>




```julia
combine(gdf, 1:2 => cor, nrow)
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>SepalLength_SepalWidth_cor</th><th>nrow</th></tr><tr><th></th><th>String15</th><th>Float64</th><th>Int64</th></tr></thead><tbody><p>3 rows × 3 columns</p><tr><th>1</th><td>Iris-setosa</td><td>0.74678</td><td>50</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>0.525911</td><td>50</td></tr><tr><th>3</th><td>Iris-virginica</td><td>0.457228</td><td>50</td></tr></tbody></table>




```julia
# combine(gdf, :PetalLength => (x -> [extrema(x)]) => [:min, :max])
```

与' combine '相反，' select '和' transform '函数总是返回与源数据帧具有相同数量和行顺序的数据帧。在下面的例子中，':SepalLength_SepalWidth_cor '和':nrow '中的返回值被广播以匹配每个组中的元素数量:


```julia
select(gdf, 1:2 => cor)
transform(gdf, :Species => x -> chop.(x, head=5, tail=0))
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species_function</th></tr><tr><th></th><th>String15</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><p>150 rows × 6 columns</p><tr><th>1</th><td>Iris-setosa</td><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><th>2</th><td>Iris-setosa</td><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><th>3</th><td>Iris-setosa</td><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>setosa</td></tr><tr><th>4</th><td>Iris-setosa</td><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>setosa</td></tr><tr><th>5</th><td>Iris-setosa</td><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><th>6</th><td>Iris-setosa</td><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td><td>setosa</td></tr><tr><th>7</th><td>Iris-setosa</td><td>4.6</td><td>3.4</td><td>1.4</td><td>0.3</td><td>setosa</td></tr><tr><th>8</th><td>Iris-setosa</td><td>5.0</td><td>3.4</td><td>1.5</td><td>0.2</td><td>setosa</td></tr><tr><th>9</th><td>Iris-setosa</td><td>4.4</td><td>2.9</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><th>10</th><td>Iris-setosa</td><td>4.9</td><td>3.1</td><td>1.5</td><td>0.1</td><td>setosa</td></tr><tr><th>11</th><td>Iris-setosa</td><td>5.4</td><td>3.7</td><td>1.5</td><td>0.2</td><td>setosa</td></tr><tr><th>12</th><td>Iris-setosa</td><td>4.8</td><td>3.4</td><td>1.6</td><td>0.2</td><td>setosa</td></tr><tr><th>13</th><td>Iris-setosa</td><td>4.8</td><td>3.0</td><td>1.4</td><td>0.1</td><td>setosa</td></tr><tr><th>14</th><td>Iris-setosa</td><td>4.3</td><td>3.0</td><td>1.1</td><td>0.1</td><td>setosa</td></tr><tr><th>15</th><td>Iris-setosa</td><td>5.8</td><td>4.0</td><td>1.2</td><td>0.2</td><td>setosa</td></tr><tr><th>16</th><td>Iris-setosa</td><td>5.7</td><td>4.4</td><td>1.5</td><td>0.4</td><td>setosa</td></tr><tr><th>17</th><td>Iris-setosa</td><td>5.4</td><td>3.9</td><td>1.3</td><td>0.4</td><td>setosa</td></tr><tr><th>18</th><td>Iris-setosa</td><td>5.1</td><td>3.5</td><td>1.4</td><td>0.3</td><td>setosa</td></tr><tr><th>19</th><td>Iris-setosa</td><td>5.7</td><td>3.8</td><td>1.7</td><td>0.3</td><td>setosa</td></tr><tr><th>20</th><td>Iris-setosa</td><td>5.1</td><td>3.8</td><td>1.5</td><td>0.3</td><td>setosa</td></tr><tr><th>21</th><td>Iris-setosa</td><td>5.4</td><td>3.4</td><td>1.7</td><td>0.2</td><td>setosa</td></tr><tr><th>22</th><td>Iris-setosa</td><td>5.1</td><td>3.7</td><td>1.5</td><td>0.4</td><td>setosa</td></tr><tr><th>23</th><td>Iris-setosa</td><td>4.6</td><td>3.6</td><td>1.0</td><td>0.2</td><td>setosa</td></tr><tr><th>24</th><td>Iris-setosa</td><td>5.1</td><td>3.3</td><td>1.7</td><td>0.5</td><td>setosa</td></tr><tr><th>25</th><td>Iris-setosa</td><td>4.8</td><td>3.4</td><td>1.9</td><td>0.2</td><td>setosa</td></tr><tr><th>26</th><td>Iris-setosa</td><td>5.0</td><td>3.0</td><td>1.6</td><td>0.2</td><td>setosa</td></tr><tr><th>27</th><td>Iris-setosa</td><td>5.0</td><td>3.4</td><td>1.6</td><td>0.4</td><td>setosa</td></tr><tr><th>28</th><td>Iris-setosa</td><td>5.2</td><td>3.5</td><td>1.5</td><td>0.2</td><td>setosa</td></tr><tr><th>29</th><td>Iris-setosa</td><td>5.2</td><td>3.4</td><td>1.4</td><td>0.2</td><td>setosa</td></tr><tr><th>30</th><td>Iris-setosa</td><td>4.7</td><td>3.2</td><td>1.6</td><td>0.2</td><td>setosa</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>



所有函数都支持“do”块形式。但是，如上所述，这种形式速度较慢，因此在性能问题上应该避免使用。


```julia
combine(gdf) do df
           (m = mean(df.PetalLength), s² = var(df.PetalLength))
       end
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>m</th><th>s²</th></tr><tr><th></th><th>String15</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>3 rows × 3 columns</p><tr><th>1</th><td>Iris-setosa</td><td>1.464</td><td>0.0301061</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>4.26</td><td>0.220816</td></tr><tr><th>3</th><td>Iris-virginica</td><td>5.552</td><td>0.304588</td></tr></tbody></table>



如果你只想把数据集分成子集，使用[' groupby '](@ref)函数:


```julia
for subdf in groupby(iris, :Species)
   println(size(subdf, 1))
end
```

    50
    50
    50


使用' pairs '函数也可以获得每个组的分组列的值:


```julia
for (key, subdf) in pairs(groupby(iris, :Species))
   println("Number of data points for $(key.Species): $(nrow(subdf))")
end
```

    Number of data points for Iris-setosa: 50
    Number of data points for Iris-versicolor: 50
    Number of data points for Iris-virginica: 50


在前面的例子中，' key '的值是一个[' DataFrames.GroupKey '](@ref)对象，可以以类似于' NamedTuple '的方式使用。


使用“groupby”函数对数据帧进行分组，可以看作是向其添加一个查找键。这样的查找可以通过用' Tuple '或' NamedTuple '索引结果' GroupedDataFrame '来有效地执行:


```julia
df = DataFrame(g=repeat(1:1000, inner=5), x=1:5000)
```




<table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>5,000 rows × 2 columns</p><tr><th>1</th><td>1</td><td>1</td></tr><tr><th>2</th><td>1</td><td>2</td></tr><tr><th>3</th><td>1</td><td>3</td></tr><tr><th>4</th><td>1</td><td>4</td></tr><tr><th>5</th><td>1</td><td>5</td></tr><tr><th>6</th><td>2</td><td>6</td></tr><tr><th>7</th><td>2</td><td>7</td></tr><tr><th>8</th><td>2</td><td>8</td></tr><tr><th>9</th><td>2</td><td>9</td></tr><tr><th>10</th><td>2</td><td>10</td></tr><tr><th>11</th><td>3</td><td>11</td></tr><tr><th>12</th><td>3</td><td>12</td></tr><tr><th>13</th><td>3</td><td>13</td></tr><tr><th>14</th><td>3</td><td>14</td></tr><tr><th>15</th><td>3</td><td>15</td></tr><tr><th>16</th><td>4</td><td>16</td></tr><tr><th>17</th><td>4</td><td>17</td></tr><tr><th>18</th><td>4</td><td>18</td></tr><tr><th>19</th><td>4</td><td>19</td></tr><tr><th>20</th><td>4</td><td>20</td></tr><tr><th>21</th><td>5</td><td>21</td></tr><tr><th>22</th><td>5</td><td>22</td></tr><tr><th>23</th><td>5</td><td>23</td></tr><tr><th>24</th><td>5</td><td>24</td></tr><tr><th>25</th><td>5</td><td>25</td></tr><tr><th>26</th><td>6</td><td>26</td></tr><tr><th>27</th><td>6</td><td>27</td></tr><tr><th>28</th><td>6</td><td>28</td></tr><tr><th>29</th><td>6</td><td>29</td></tr><tr><th>30</th><td>6</td><td>30</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>




```julia
gdf = groupby(df, :g)
```




<p><b>GroupedDataFrame with 1000 groups based on key: g</b></p><p><i>First Group (5 rows): g = 1</i></p><table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>1</td><td>1</td></tr><tr><th>2</th><td>1</td><td>2</td></tr><tr><th>3</th><td>1</td><td>3</td></tr><tr><th>4</th><td>1</td><td>4</td></tr><tr><th>5</th><td>1</td><td>5</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (5 rows): g = 1000</i></p><table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>1000</td><td>4996</td></tr><tr><th>2</th><td>1000</td><td>4997</td></tr><tr><th>3</th><td>1000</td><td>4998</td></tr><tr><th>4</th><td>1000</td><td>4999</td></tr><tr><th>5</th><td>1000</td><td>5000</td></tr></tbody></table>




```julia
gdf[(g=500,)]
```




<table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>5 rows × 2 columns</p><tr><th>1</th><td>500</td><td>2496</td></tr><tr><th>2</th><td>500</td><td>2497</td></tr><tr><th>3</th><td>500</td><td>2498</td></tr><tr><th>4</th><td>500</td><td>2499</td></tr><tr><th>5</th><td>500</td><td>2500</td></tr></tbody></table>




```julia
gdf[[(500,), (501,)]]
```




<p><b>GroupedDataFrame with 2 groups based on key: g</b></p><p><i>First Group (5 rows): g = 500</i></p><table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>500</td><td>2496</td></tr><tr><th>2</th><td>500</td><td>2497</td></tr><tr><th>3</th><td>500</td><td>2498</td></tr><tr><th>4</th><td>500</td><td>2499</td></tr><tr><th>5</th><td>500</td><td>2500</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (5 rows): g = 501</i></p><table class="data-frame"><thead><tr><th></th><th>g</th><th>x</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>501</td><td>2501</td></tr><tr><th>2</th><td>501</td><td>2502</td></tr><tr><th>3</th><td>501</td><td>2503</td></tr><tr><th>4</th><td>501</td><td>2504</td></tr><tr><th>5</th><td>501</td><td>2505</td></tr></tbody></table>



为了对' GroupedDataFrame '的每个非分组列应用一个函数，你可以这样写:


```julia
gd = groupby(iris, :Species)
```




<p><b>GroupedDataFrame with 3 groups based on key: Species</b></p><p><i>First Group (50 rows): Species = "Iris-setosa"</i></p><table class="data-frame"><thead><tr><th></th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><tr><th>1</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>2</th><td>4.9</td><td>3.0</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>3</th><td>4.7</td><td>3.2</td><td>1.3</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>4</th><td>4.6</td><td>3.1</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>5</th><td>5.0</td><td>3.6</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>6</th><td>5.4</td><td>3.9</td><td>1.7</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>7</th><td>4.6</td><td>3.4</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>8</th><td>5.0</td><td>3.4</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>9</th><td>4.4</td><td>2.9</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>10</th><td>4.9</td><td>3.1</td><td>1.5</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>11</th><td>5.4</td><td>3.7</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>12</th><td>4.8</td><td>3.4</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>13</th><td>4.8</td><td>3.0</td><td>1.4</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>14</th><td>4.3</td><td>3.0</td><td>1.1</td><td>0.1</td><td>Iris-setosa</td></tr><tr><th>15</th><td>5.8</td><td>4.0</td><td>1.2</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>16</th><td>5.7</td><td>4.4</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>17</th><td>5.4</td><td>3.9</td><td>1.3</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>18</th><td>5.1</td><td>3.5</td><td>1.4</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>19</th><td>5.7</td><td>3.8</td><td>1.7</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>20</th><td>5.1</td><td>3.8</td><td>1.5</td><td>0.3</td><td>Iris-setosa</td></tr><tr><th>21</th><td>5.4</td><td>3.4</td><td>1.7</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>22</th><td>5.1</td><td>3.7</td><td>1.5</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>23</th><td>4.6</td><td>3.6</td><td>1.0</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>24</th><td>5.1</td><td>3.3</td><td>1.7</td><td>0.5</td><td>Iris-setosa</td></tr><tr><th>25</th><td>4.8</td><td>3.4</td><td>1.9</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>26</th><td>5.0</td><td>3.0</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>27</th><td>5.0</td><td>3.4</td><td>1.6</td><td>0.4</td><td>Iris-setosa</td></tr><tr><th>28</th><td>5.2</td><td>3.5</td><td>1.5</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>29</th><td>5.2</td><td>3.4</td><td>1.4</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>30</th><td>4.7</td><td>3.2</td><td>1.6</td><td>0.2</td><td>Iris-setosa</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (50 rows): Species = "Iris-virginica"</i></p><table class="data-frame"><thead><tr><th></th><th>SepalLength</th><th>SepalWidth</th><th>PetalLength</th><th>PetalWidth</th><th>Species</th></tr><tr><th></th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th><th>String15</th></tr></thead><tbody><tr><th>1</th><td>6.3</td><td>3.3</td><td>6.0</td><td>2.5</td><td>Iris-virginica</td></tr><tr><th>2</th><td>5.8</td><td>2.7</td><td>5.1</td><td>1.9</td><td>Iris-virginica</td></tr><tr><th>3</th><td>7.1</td><td>3.0</td><td>5.9</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>4</th><td>6.3</td><td>2.9</td><td>5.6</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>5</th><td>6.5</td><td>3.0</td><td>5.8</td><td>2.2</td><td>Iris-virginica</td></tr><tr><th>6</th><td>7.6</td><td>3.0</td><td>6.6</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>7</th><td>4.9</td><td>2.5</td><td>4.5</td><td>1.7</td><td>Iris-virginica</td></tr><tr><th>8</th><td>7.3</td><td>2.9</td><td>6.3</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>9</th><td>6.7</td><td>2.5</td><td>5.8</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>10</th><td>7.2</td><td>3.6</td><td>6.1</td><td>2.5</td><td>Iris-virginica</td></tr><tr><th>11</th><td>6.5</td><td>3.2</td><td>5.1</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>12</th><td>6.4</td><td>2.7</td><td>5.3</td><td>1.9</td><td>Iris-virginica</td></tr><tr><th>13</th><td>6.8</td><td>3.0</td><td>5.5</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>14</th><td>5.7</td><td>2.5</td><td>5.0</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>15</th><td>5.8</td><td>2.8</td><td>5.1</td><td>2.4</td><td>Iris-virginica</td></tr><tr><th>16</th><td>6.4</td><td>3.2</td><td>5.3</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>17</th><td>6.5</td><td>3.0</td><td>5.5</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>18</th><td>7.7</td><td>3.8</td><td>6.7</td><td>2.2</td><td>Iris-virginica</td></tr><tr><th>19</th><td>7.7</td><td>2.6</td><td>6.9</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>20</th><td>6.0</td><td>2.2</td><td>5.0</td><td>1.5</td><td>Iris-virginica</td></tr><tr><th>21</th><td>6.9</td><td>3.2</td><td>5.7</td><td>2.3</td><td>Iris-virginica</td></tr><tr><th>22</th><td>5.6</td><td>2.8</td><td>4.9</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>23</th><td>7.7</td><td>2.8</td><td>6.7</td><td>2.0</td><td>Iris-virginica</td></tr><tr><th>24</th><td>6.3</td><td>2.7</td><td>4.9</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>25</th><td>6.7</td><td>3.3</td><td>5.7</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>26</th><td>7.2</td><td>3.2</td><td>6.0</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>27</th><td>6.2</td><td>2.8</td><td>4.8</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>28</th><td>6.1</td><td>3.0</td><td>4.9</td><td>1.8</td><td>Iris-virginica</td></tr><tr><th>29</th><td>6.4</td><td>2.8</td><td>5.6</td><td>2.1</td><td>Iris-virginica</td></tr><tr><th>30</th><td>7.2</td><td>3.0</td><td>5.8</td><td>1.6</td><td>Iris-virginica</td></tr><tr><th>&vellip;</th><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td><td>&vellip;</td></tr></tbody></table>




```julia
combine(gd, valuecols(gd) .=> mean)
```




<table class="data-frame"><thead><tr><th></th><th>Species</th><th>SepalLength_mean</th><th>SepalWidth_mean</th><th>PetalLength_mean</th><th>PetalWidth_mean</th></tr><tr><th></th><th>String15</th><th>Float64</th><th>Float64</th><th>Float64</th><th>Float64</th></tr></thead><tbody><p>3 rows × 5 columns</p><tr><th>1</th><td>Iris-setosa</td><td>5.006</td><td>3.418</td><td>1.464</td><td>0.244</td></tr><tr><th>2</th><td>Iris-versicolor</td><td>5.936</td><td>2.77</td><td>4.26</td><td>1.326</td></tr><tr><th>3</th><td>Iris-virginica</td><td>6.588</td><td>2.974</td><td>5.552</td><td>2.026</td></tr></tbody></table>



注意' GroupedDataFrame '是一个视图:因此它的父数据帧的分组列不能被改变，行不能从它中添加或删除。如果父对象的行数或行数发生了变化，那么当使用子对象“GroupedDataFrame”时将抛出一个错误:


```julia
df = DataFrame(id=1:2)
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>2 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr></tbody></table>




```julia
gd = groupby(df, :id)
```




<p><b>GroupedDataFrame with 2 groups based on key: id</b></p><p><i>First Group (1 row): id = 1</i></p><table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>1</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (1 row): id = 2</i></p><table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>2</td></tr></tbody></table>




```julia
push!(df, [3])
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>3 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr><tr><th>3</th><td>3</td></tr></tbody></table>




```julia
gd[1]
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>1 rows × 1 columns</p><tr><th>1</th><td>1</td></tr></tbody></table>



有时，在' GroupedDataFrame '的源数据帧中添加行是有用的，而不会影响用于分组的行。在这种情况下，你可以使用父数据帧的“视图”来创建分组数据帧，以避免错误:


```julia
df = DataFrame(id=1:2)
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>2 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr></tbody></table>




```julia
gd = groupby(view(df, :, :), :id)
```




<p><b>GroupedDataFrame with 2 groups based on key: id</b></p><p><i>First Group (1 row): id = 1</i></p><table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>1</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (1 row): id = 2</i></p><table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>2</td></tr></tbody></table>




```julia
push!(df, [3])
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>3 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr><tr><th>3</th><td>3</td></tr></tbody></table>




```julia
gd[1]
```




<table class="data-frame"><thead><tr><th></th><th>id</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>1 rows × 1 columns</p><tr><th>1</th><td>1</td></tr></tbody></table>



#  模拟SQL 'where' 子句
你可以通过使用' SubDataFrame ' s方便地处理数据帧的子集。在这些对象上执行的操作可以创建一个新的数据帧，也可以就地执行。下面是一些例子:


```julia
df = DataFrame(a=1:5)
```




<table class="data-frame"><thead><tr><th></th><th>a</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>5 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr><tr><th>3</th><td>3</td></tr><tr><th>4</th><td>4</td></tr><tr><th>5</th><td>5</td></tr></tbody></table>




```julia
sdf = @view df[2:3, :]
```




<table class="data-frame"><thead><tr><th></th><th>a</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>2 rows × 1 columns</p><tr><th>1</th><td>2</td></tr><tr><th>2</th><td>3</td></tr></tbody></table>




```julia
transform(sdf, :a => ByRow(string)) # create a new data frame
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>a_string</th></tr><tr><th></th><th>Int64</th><th>String</th></tr></thead><tbody><p>2 rows × 2 columns</p><tr><th>1</th><td>2</td><td>2</td></tr><tr><th>2</th><td>3</td><td>3</td></tr></tbody></table>




```julia
# transform!(sdf, :a => ByRow(string)) # update the source df in-place
```


```julia
df # new column was created filled with missing in filtered-out rows
```




<table class="data-frame"><thead><tr><th></th><th>a</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>5 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr><tr><th>3</th><td>3</td></tr><tr><th>4</th><td>4</td></tr><tr><th>5</th><td>5</td></tr></tbody></table>




```julia
# select!(sdf, :a => -, renamecols=false) # update the source df in-place
```


```julia
df # the column replaced an existing column; previously stored values are re-used in filtered-out rows
```




<table class="data-frame"><thead><tr><th></th><th>a</th></tr><tr><th></th><th>Int64</th></tr></thead><tbody><p>5 rows × 1 columns</p><tr><th>1</th><td>1</td></tr><tr><th>2</th><td>2</td></tr><tr><th>3</th><td>3</td></tr><tr><th>4</th><td>4</td></tr><tr><th>5</th><td>5</td></tr></tbody></table>



类似的操作也可以在' GroupedDataFrame '上执行:


```julia
df = DataFrame(a=[1, 1, 1, 2, 2, 3], b=1:6)
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>6 rows × 2 columns</p><tr><th>1</th><td>1</td><td>1</td></tr><tr><th>2</th><td>1</td><td>2</td></tr><tr><th>3</th><td>1</td><td>3</td></tr><tr><th>4</th><td>2</td><td>4</td></tr><tr><th>5</th><td>2</td><td>5</td></tr><tr><th>6</th><td>3</td><td>6</td></tr></tbody></table>




```julia
sdf = @view df[2:4, :]
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>3 rows × 2 columns</p><tr><th>1</th><td>1</td><td>2</td></tr><tr><th>2</th><td>1</td><td>3</td></tr><tr><th>3</th><td>2</td><td>4</td></tr></tbody></table>




```julia
gsdf = groupby(sdf, :a)
```




<p><b>GroupedDataFrame with 2 groups based on key: a</b></p><p><i>First Group (2 rows): a = 1</i></p><table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>1</td><td>2</td></tr><tr><th>2</th><td>1</td><td>3</td></tr></tbody></table><p>&vellip;</p><p><i>Last Group (1 row): a = 2</i></p><table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><tr><th>1</th><td>2</td><td>4</td></tr></tbody></table>




```julia
transform(gsdf, nrow) # create a new data frame
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th><th>nrow</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>3 rows × 3 columns</p><tr><th>1</th><td>1</td><td>2</td><td>2</td></tr><tr><th>2</th><td>1</td><td>3</td><td>2</td></tr><tr><th>3</th><td>2</td><td>4</td><td>1</td></tr></tbody></table>




```julia
# transform!(gsdf, nrow, :b => :b_copy)
```


```julia
df
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>6 rows × 2 columns</p><tr><th>1</th><td>1</td><td>1</td></tr><tr><th>2</th><td>1</td><td>2</td></tr><tr><th>3</th><td>1</td><td>3</td></tr><tr><th>4</th><td>2</td><td>4</td></tr><tr><th>5</th><td>2</td><td>5</td></tr><tr><th>6</th><td>3</td><td>6</td></tr></tbody></table>




```julia
# select!(gsdf, :b_copy, :b => sum, renamecols=false)
```


```julia
df
```




<table class="data-frame"><thead><tr><th></th><th>a</th><th>b</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>6 rows × 2 columns</p><tr><th>1</th><td>1</td><td>1</td></tr><tr><th>2</th><td>1</td><td>2</td></tr><tr><th>3</th><td>1</td><td>3</td></tr><tr><th>4</th><td>2</td><td>4</td></tr><tr><th>5</th><td>2</td><td>5</td></tr><tr><th>6</th><td>3</td><td>6</td></tr></tbody></table>


