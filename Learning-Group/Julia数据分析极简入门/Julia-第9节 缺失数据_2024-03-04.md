# Juliaæ•°æ®åˆ†ææç®€å…¥é—¨


## ç¬¬9èŠ‚ ç¼ºå¤±çš„æ•°æ®

åœ¨Juliaä¸­ï¼Œæ•°æ®ä¸­çš„ç¼ºå¤±å€¼ä½¿ç”¨ç‰¹æ®Šå¯¹è±¡`missing`è¡¨ç¤ºï¼Œå®ƒæ˜¯`missing`ç±»å‹çš„å•ä¸ªå®ä¾‹ã€‚


```julia
missing
```




    missing




```julia
typeof(missing)

```




    Missing



â€œMissingâ€ç±»å‹å…è®¸ç”¨æˆ·åˆ›å»ºå¸¦æœ‰ç¼ºå¤±å€¼çš„å‘é‡å’Œâ€œDataFrameâ€åˆ—ã€‚è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç¼ºå°‘å€¼çš„å‘é‡ï¼Œè¿”å›å‘é‡çš„å…ƒç´ ç±»å‹æ˜¯' Union{missing, Int64} 'ã€‚


```julia
x = [1, 2, missing]
```




    3-element Array{Union{Missing, Int64},1}:
     1
     2
      missing




```julia
eltype(x)
```




    Union{Missing, Int64}




```julia
eltype(x) == Union{Missing, Int}
```




    true



å½“ä½¿ç”¨' skipmissing 'æ‰§è¡Œæ“ä½œæ—¶ï¼Œ' missing 'å€¼å¯ä»¥è¢«æ’é™¤ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªèŠ‚çœå†…å­˜çš„è¿­ä»£å™¨ã€‚


```julia
skipmissing(x)
```




    skipmissing(Union{Missing, Int64}[1, 2, missing])



`skipmissing`çš„è¾“å‡ºå¯ä»¥ä½œä¸ºå‚æ•°ç›´æ¥ä¼ é€’ç»™å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æ‰€æœ‰éç¼ºå¤±å€¼çš„`sum` ï¼Œæˆ–è€…å°†éç¼ºå¤±å€¼`collect`åˆ°ä¸€ä¸ªæ–°çš„æ— ç¼ºå¤±å‘é‡ä¸­ã€‚


```julia
sum(skipmissing(x))
```




    3




```julia
collect(skipmissing(x))
```




    2-element Array{Int64,1}:
     1
     2



å‡½æ•°' coalesce 'å¯ä»¥ç”¨æ¥ç”¨å¦ä¸€ä¸ªå€¼æ›¿æ¢ç¼ºå¤±çš„å€¼(æ³¨æ„è¿™ä¸ªç‚¹ï¼Œè¡¨ç¤ºæ›¿æ¢åº”è¯¥åº”ç”¨äº' x 'ä¸­çš„æ‰€æœ‰æ¡ç›®):


```julia
coalesce.(x, 0)
```




    3-element Array{Int64,1}:
     1
     2
     0



å‡½æ•°[' dropmissing '](@ref)å’Œ[' dropmissing! '](@ref)å¯ç”¨äºä»æ•°æ®å¸§ä¸­åˆ é™¤åŒ…å«' missing 'å€¼çš„è¡Œï¼Œå¹¶åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæ–°çš„' DataFrame 'æˆ–æ”¹å˜åŸå§‹çš„æ•°æ®å¸§ã€‚


```julia
using DataFrames
```


```julia
df = DataFrame(i=1:5,
                      x=[missing, 4, missing, 2, 1],
                      y=[missing, missing, "c", "d", "e"])
```




<table class="data-frame"><thead><tr><th></th><th>i</th><th>x</th><th>y</th></tr><tr><th></th><th>Int64</th><th>Int64?</th><th>String?</th></tr></thead><tbody><p>5 rows Ã— 3 columns</p><tr><th>1</th><td>1</td><td><em>missing</em></td><td><em>missing</em></td></tr><tr><th>2</th><td>2</td><td>4</td><td><em>missing</em></td></tr><tr><th>3</th><td>3</td><td><em>missing</em></td><td>c</td></tr><tr><th>4</th><td>4</td><td>2</td><td>d</td></tr><tr><th>5</th><td>5</td><td>1</td><td>e</td></tr></tbody></table>




```julia
dropmissing(df)
```




<table class="data-frame"><thead><tr><th></th><th>i</th><th>x</th><th>y</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String</th></tr></thead><tbody><p>2 rows Ã— 3 columns</p><tr><th>1</th><td>4</td><td>2</td><td>d</td></tr><tr><th>2</th><td>5</td><td>1</td><td>e</td></tr></tbody></table>



å¯ä»¥æŒ‡å®šåœ¨å…¶ä¸­æœç´¢åŒ…å«è¦åˆ é™¤çš„ `missing`å€¼çš„è¡Œã€‚


```julia
dropmissing(df, :x)
```




<table class="data-frame"><thead><tr><th></th><th>i</th><th>x</th><th>y</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String?</th></tr></thead><tbody><p>3 rows Ã— 3 columns</p><tr><th>1</th><td>2</td><td>4</td><td><em>missing</em></td></tr><tr><th>2</th><td>4</td><td>2</td><td>d</td></tr><tr><th>3</th><td>5</td><td>1</td><td>e</td></tr></tbody></table>



é»˜è®¤æƒ…å†µä¸‹ï¼Œ[' dropmissing '](@ref)å’Œ[' dropmissing! '](@ref)å‡½æ•°åœ¨é€‰å®šçš„åˆ—ä¸­ä¿ç•™' Union{T, Missing} 'å…ƒç´ ç±»å‹ï¼Œä»¥ä¾¿è¡Œåˆ é™¤ã€‚è¦åˆ é™¤' Missing 'éƒ¨åˆ†ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°†' disallowmissing 'å…³é”®å­—å‚æ•°è®¾ç½®ä¸º' true '(å®ƒå°†æˆä¸ºæœªæ¥çš„é»˜è®¤è¡Œä¸º)ã€‚


```julia
dropmissing(df, disallowmissing=true)
```




<table class="data-frame"><thead><tr><th></th><th>i</th><th>x</th><th>y</th></tr><tr><th></th><th>Int64</th><th>Int64</th><th>String</th></tr></thead><tbody><p>2 rows Ã— 3 columns</p><tr><th>1</th><td>4</td><td>2</td><td>d</td></tr><tr><th>2</th><td>5</td><td>1</td><td>e</td></tr></tbody></table>



æœ‰æ—¶å…è®¸æˆ–ä¸å…è®¸åœ¨æ•°æ®å¸§çš„æŸäº›åˆ—ä¸­æ”¯æŒç¼ºå¤±å€¼æ˜¯æœ‰ç”¨çš„ã€‚è¿™äº›æ“ä½œç”±[' allowmissing '](@ref)ï¼Œ [' allowmissing! '](@ref)ï¼Œ [' disallowmissing '](@ref)å’Œ[' disallowmissing! '](@ref)å‡½æ•°æ”¯æŒã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:


```julia
df = DataFrame(x=1:3, y=4:6)
```




<table class="data-frame"><thead><tr><th></th><th>x</th><th>y</th></tr><tr><th></th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>3 rows Ã— 2 columns</p><tr><th>1</th><td>1</td><td>4</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th>3</th><td>3</td><td>6</td></tr></tbody></table>




```julia
allowmissing!(df)
```




<table class="data-frame"><thead><tr><th></th><th>x</th><th>y</th></tr><tr><th></th><th>Int64?</th><th>Int64?</th></tr></thead><tbody><p>3 rows Ã— 2 columns</p><tr><th>1</th><td>1</td><td>4</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th>3</th><td>3</td><td>6</td></tr></tbody></table>



ç°åœ¨' df 'å…è®¸æ‰€æœ‰åˆ—ä¸­éƒ½æœ‰ç¼ºå¤±å€¼ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œå°†' df 'ä¸­çš„ä¸€äº›å€¼è®¾ç½®ä¸º' missing 'ï¼Œä¾‹å¦‚:


```julia
df[1, 1] = missing
```




    missing




```julia
df
```




<table class="data-frame"><thead><tr><th></th><th>x</th><th>y</th></tr><tr><th></th><th>Int64?</th><th>Int64?</th></tr></thead><tbody><p>3 rows Ã— 2 columns</p><tr><th>1</th><td><em>missing</em></td><td>4</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th>3</th><td>3</td><td>6</td></tr></tbody></table>



è¯·æ³¨æ„ï¼Œåˆ—é€‰æ‹©å™¨å¯ä»¥ä½œä¸ºç¬¬äºŒä¸ªä½ç½®å‚æ•°ä¼ é€’ç»™[' allowmissing '](@ref)å’Œ[' allowmissing! '](@ref)ï¼Œä»¥å°†æ›´æ”¹é™åˆ¶åˆ°æ•°æ®å¸§ä¸­çš„æŸäº›åˆ—ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ‰§è¡Œç›¸åçš„æ“ä½œï¼Œç¦æ­¢' df 'ä¸­çš„ç¼ºå¤±å€¼ã€‚æˆ‘ä»¬çŸ¥é“åˆ—':y 'ä¸åŒ…å«ç¼ºå¤±å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[' disallowmissing '](@ref)å‡½æ•°ä¼ é€’ä¸€ä¸ªåˆ—é€‰æ‹©å™¨ä½œä¸ºç¬¬äºŒä¸ªä½ç½®å‚æ•°:


```julia
disallowmissing(df, :y)
```




<table class="data-frame"><thead><tr><th></th><th>x</th><th>y</th></tr><tr><th></th><th>Int64?</th><th>Int64</th></tr></thead><tbody><p>3 rows Ã— 2 columns</p><tr><th>1</th><td><em>missing</em></td><td>4</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th>3</th><td>3</td><td>6</td></tr></tbody></table>



è¯¥æ“ä½œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„â€œDataFrameâ€ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å°±åœ°æ›´æ–°' df 'ï¼Œåº”è¯¥ä½¿ç”¨[' disallowmissing! '](@ref)å‡½æ•°ã€‚

å¦‚æœæˆ‘ä»¬è¯•å›¾ä½¿ç”¨' disallowmissing(df) 'åœ¨æ•´ä¸ªæ•°æ®å¸§ä¸­ç¦æ­¢ç¼ºå¤±ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚ç„¶è€Œï¼Œç¦æ­¢åœ¨æ‰€æœ‰å®é™…ä¸Šä¸åŒ…å«è¿™äº›å€¼çš„åˆ—ä¸­é—æ¼å®ƒä»¬ï¼Œä½†ä¿æŒæœ‰ä¸€äº›â€œé—æ¼â€å€¼çš„åˆ—ä¸å˜ï¼Œè€Œä¸å¿…æ˜¾å¼åˆ—å‡ºå®ƒä»¬ï¼Œè¿™é€šå¸¸æ˜¯æœ‰ç”¨çš„ã€‚è¿™å¯ä»¥é€šè¿‡ä¼ é€’' error=false 'å…³é”®å­—å‚æ•°æ¥å®ç°:


```julia
disallowmissing(df, error=false)
```




<table class="data-frame"><thead><tr><th></th><th>x</th><th>y</th></tr><tr><th></th><th>Int64?</th><th>Int64</th></tr></thead><tbody><p>3 rows Ã— 2 columns</p><tr><th>1</th><td><em>missing</em></td><td>4</td></tr><tr><th>2</th><td>2</td><td>5</td></tr><tr><th>3</th><td>3</td><td>6</td></tr></tbody></table>



[misses .jl](https://github.com/JuliaData/Missings.jl)åŒ…æä¾›äº†ä¸€äº›å¤„ç†ç¼ºå¤±å€¼çš„æ–¹ä¾¿å‡½æ•°ã€‚å…¶ä¸­æœ€å¸¸ç”¨çš„æ˜¯â€œpassmissingâ€ã€‚å®ƒæ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œä»¥æŸä¸ªå‡½æ•°â€œfâ€ä½œä¸ºå…¶å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¦‚æœå…¶ä»»ä½•ä½ç½®å‚æ•°â€œmissingâ€ï¼Œåˆ™è¿”å›â€œmissingâ€ï¼Œå¦åˆ™å°†å‡½æ•°â€œfâ€åº”ç”¨äºè¿™äº›å‚æ•°ã€‚æ­¤åŠŸèƒ½ä¸ä¸æ”¯æŒä¼ é€’â€œç¼ºå¤±â€å€¼ä½œä¸ºå‚æ•°çš„å‡½æ•°ç»“åˆä½¿ç”¨æ—¶éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå°è¯•' uppercase(missing) 'å°†äº§ç”Ÿä¸€ä¸ªé”™è¯¯ï¼Œè€Œä¸‹é¢çš„å·¥ä½œ:


```julia
passmissing(uppercase)("a")
```




    "A"




```julia
passmissing(uppercase)(missing)
```




    missing



å‡½æ•°`Missings.replace` è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”¨å¦ä¸€ä¸ªå€¼æ›¿æ¢`missing`çš„å…ƒç´ :


```julia
using Pkg;
Pkg.add("Missings")
```

    [32m[1m   Updating[22m[39m registry at `~/.julia/registries/General`
    ######################################################################### 100.0%           2.5%                         10.8%                         14.2%                 39.4%#####            86.7%
    [32m[1m  Resolving[22m[39m package versions...
    [32m[1mUpdating[22m[39m `~/.julia/environments/v1.5/Project.toml`
     [90m [e1d29d7a] [39m[92m+ Missings v0.4.5[39m
    [32m[1mNo Changes[22m[39m to `~/.julia/environments/v1.5/Manifest.toml`



```julia
using Missings
```


```julia
Missings.replace(x, 1)
```




    Missings.EachReplaceMissing{Array{Union{Missing, Int64},1},Int64}(Union{Missing, Int64}[1, 2, missing], 1)




```julia
collect(Missings.replace(x, 1))
```




    3-element Array{Int64,1}:
     1
     2
     1




```julia
collect(Missings.replace(x, 1)) == coalesce.(x, 1)
true
```




    true



The function `nonmissingtype` returns the element-type `T` in `Union{T, Missing}`.

å‡½æ•°`nonmissingtype` è¿”å›`Union{T, Missing}`ä¸­çš„å…ƒç´ ç±»å‹`T` ã€‚


```julia
eltype(x)
```




    Union{Missing, Int64}




```julia
nonmissingtype(eltype(x))
```




    Int64



`missings`å‡½æ•°ä½¿ç”¨å¯é€‰çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå…ƒç´ ç±»å‹ï¼Œæ„é€ `Vector`å’Œ`Array`çš„æ”¯æŒç¼ºå¤±å€¼ã€‚


```julia
missings(1)
```




    1-element Array{Missing,1}:
     missing




```julia
missings(3)
```




    3-element Array{Missing,1}:
     missing
     missing
     missing




```julia
missings(1, 3)
```




    1Ã—3 Array{Missing,2}:
     missing  missing  missing




```julia
missings(Int, 1, 3)
```




    1Ã—3 Array{Union{Missing, Int64},2}:
     missing  missing  missing



æœ‰å…³ç¼ºå¤±å€¼çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Juliaæ‰‹å†Œ](https://docs.julialang.org/en/v1/manual/missing/)
