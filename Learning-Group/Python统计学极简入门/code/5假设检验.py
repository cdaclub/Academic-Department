#!/usr/bin/env python
# coding: utf-8

# ### ä¸€ä¸ªæ€»ä½“ å‡å€¼çš„å‡è®¾æ£€éªŒ (æŒ‡å®šå€¼å’Œæ ·æœ¬å‡å€¼)

# In[44]:


from scipy import stats
import scipy.stats
import numpy as np
import pandas  as pd
import statsmodels.stats.weightstats


# #### å¤§æ ·æœ¬ $\sigma$ å·²çŸ¥ : $z$ æ£€éªŒ

# **ä¾‹5.1 æ£€éªŒä¸€æ‰¹å‚å®¶ç”Ÿäº§çš„çº¢ç³–æ˜¯å¦å¤Ÿæ ‡é‡** 
# 
# ç›‘ç£éƒ¨é—¨ç§°äº†50åŒ…æ ‡é‡500gçš„çº¢ç³–ï¼Œå‡å€¼æ˜¯498.35gï¼Œå°‘äºæ‰€æ ‡çš„500gã€‚å¯¹äºå‚å®¶ç”Ÿäº§çš„è¿™æ‰¹çº¢ç³–å¹³å‡èµ·æ¥æ˜¯å¦å¤Ÿä»½é‡ï¼Œéœ€è¦ç»Ÿè®¡æ£€éªŒã€‚
# 
# **åˆ†æè¿‡ç¨‹ï¼š**
# ç”±äºå‚å®¶å£°ç§°æ¯è¢‹500g,å› æ­¤åŸå‡è®¾ä¸ºæ€»ä½“å‡å€¼ç­‰äº500g(è¢«æ€€ç–‘å¯¹è±¡æ€»æ˜¯æ”¾åœ¨é›¶å‡è®¾)ã€‚è€Œä¸”ç”±äºæ ·æœ¬å‡å€¼å°‘äº500g(è¿™æ˜¯æ€€ç–‘çš„æ ¹æ®)ï¼ŒæŠŠå¤‡æ‹©å‡è®¾è®¾å®šä¸ºæ€»ä½“å‡å€¼å°‘äº500g  (ä¸Šé¢è¿™ç§å¤‡é€‰å‡è®¾ä¸ºå•å‘ä¸ç­‰å¼çš„æ£€éªŒç§°ä¸ºå•ä¾§æ£€éªŒ,è€Œå¤‡é€‰å‡è®¾ä¸ºä¸ç­‰å·â€œ$â‰ $â€çš„ç§°ä¸ºåŒä¾§æ£€éªŒï¼Œåé¢ä¼šè§£é‡Š)
# 

# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾

# $H_0:\mu = 500 \leftrightarrow  H_1ï¼š\mu <500$:

# In[787]:


data = [493.01,498.83,494.16,500.39,497.63,499.72,493.41,498.97,501.94,503.45,497.47,494.19,500.99,495.81,499.63,494.91,498.90,502.43,491.34,497.50,505.95,496.56,501.66,492.02,497.68,493.48,505.40,499.21,505.84,499.41,505.65,500.51,489.53,496.55,492.26,498.91,496.65,496.38,497.16,498.91,490.98,499.97,501.21,502.85,494.35,502.96,506.21,497.66,504.66,492.11]


# In[790]:


z, pval = statsmodels.stats.weightstats.ztest(data, value=500,alternative = 'smaller')

# 'two-sided': æ ·æœ¬å‡å€¼ä¸ç»™å®šçš„æ€»ä½“å‡å€¼ä¸åŒ
# 'larger' :   æ ·æœ¬å‡å€¼å°äºç»™å®šæ€»ä½“å‡å€¼
# 'smaller' :  æ ·æœ¬å‡å€¼å¤§äºç»™å®šæ€»ä½“å‡å€¼
print(z,pval)


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`P=0.0035 < 0.05`, æ•…åº”è¯¥æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœå€¾å‘äºæ”¯æŒå¹³å‡é‡é‡å°äº500gçš„å¤‡åˆ™å‡è®¾ã€‚

# #### å°æ ·æœ¬ $\sigma$ æœªçŸ¥ : $t$ æ£€éªŒ

# **ä¾‹5.2 æ£€éªŒæ±½è½¦å®é™…æ’æ”¾æ˜¯å¦ä½äºå…¶å£°ç§°çš„æ’æ”¾æ ‡å‡†** 
# 
# æ±½è½¦å‚å•†å£°ç§°å…¶å‘åŠ¨æœºæ’æ”¾æ ‡å‡†çš„ä¸€ä¸ªæŒ‡æ ‡å¹³å‡ä½äº20ä¸ªå•ä½ã€‚åœ¨æŠ½æŸ¥äº†10å°å‘åŠ¨æœºä¹‹å,å¾—åˆ°ä¸‹é¢çš„æ’æ”¾æ•°æ®:
# `17.0 21.7 17.9 22.9 20.7 22.4 17.3 21.8 24.2 25.4`
# è¯¥æ ·æœ¬å‡å€¼ä¸º21.13.ç©¶ç«Ÿèƒ½å¦ç”±æ­¤è®¤ä¸ºè¯¥æŒ‡æ ‡å‡å€¼è¶…è¿‡20?

# åˆ†æè¿‡ç¨‹ï¼š ç”±äºå‚å®¶å£°ç§°æŒ‡æ ‡å¹³å‡ä½äº20ä¸ªå•ä½,å› æ­¤åŸå‡è®¾ä¸ºæ€»ä½“å‡å€¼ç­‰äº20ä¸ªå•ä½(è¢«æ€€ç–‘å¯¹è±¡æ€»æ˜¯æ”¾åœ¨é›¶å‡è®¾)ã€‚è€Œä¸”ç”±äºæ ·æœ¬å‡å€¼å¤§äº20(è¿™æ˜¯æ€€ç–‘çš„æ ¹æ®)ï¼ŒæŠŠå¤‡æ‹©å‡è®¾è®¾å®šä¸ºæ€»ä½“å‡å€¼å¤§äº20ä¸ªå•ä½

# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾

# $H_0:\mu = 20 \leftrightarrow  H_1ï¼š\mu > 20$:

# In[2]:


data = [17.0, 21.7, 17.9, 22.9, 20.7, 22.4, 17.3, 21.8, 24.2, 25.4]


# In[25]:


import numpy as np
x_bar = np.array(data).mean()
x_bar


# In[36]:


((data-x_bar)**2).sum()/len(data)


# In[37]:


s = np.sqrt(((data-x_bar)**2).sum()/len(data))
s


# In[38]:


len(data)-1


# In[39]:


t = (x_bar - 20)/(s/np.sqrt(len(data)-1))
t


# In[40]:


scipy.stats.t.sf(1.2335757753252794, 9)


# In[41]:


import scipy.stats
t, pval = scipy.stats.ttest_1samp(a = data, popmean=20,alternative = 'greater')
# è¯´æ˜  
# a  ä¸ºç»™å®šçš„æ ·æœ¬æ•°æ®
# popmean ä¸ºç»™å®šçš„æ€»ä½“å‡å€¼
# alternative å®šä¹‰å¤‡æ‹©å‡è®¾ã€‚ä»¥ä¸‹é€‰é¡¹å¯ç”¨(é»˜è®¤ä¸ºâ€œtwo-sidedâ€)ï¼š
# â€˜two-sidedâ€™ï¼šæ ·æœ¬å‡å€¼ä¸ç»™å®šçš„æ€»ä½“å‡å€¼(popmean)ä¸åŒ
# â€˜lessâ€™ï¼šæ ·æœ¬å‡å€¼å°äºç»™å®šæ€»ä½“å‡å€¼(popmean)
# â€˜greaterâ€™ï¼šæ ·æœ¬å‡å€¼å¤§äºç»™å®šæ€»ä½“å‡å€¼(popmean)

print(t, pval)

# '''
# P= 0.004793 < 5%, æ‹’ç»åŸå‡è®¾ï¼Œæ¥å—å¤‡æ‹©å‡è®¾æ ·æœ¬
# '''


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.01 çš„è¯ï¼Œ`P=0.1243 > 0.05`, æ•…æ— æ³•æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœæ— æ³•æ”¯æŒæŒ‡æ ‡å‡å€¼è¶…è¿‡20çš„å¤‡åˆ™å‡è®¾ã€‚

# #### ä¸€ä¸ªæ€»ä½“æ¯”ä¾‹å‡è®¾æ£€éªŒ(æŒ‡å®šæ¯”ä¾‹å’Œæ ·æœ¬æ¯”ä¾‹çš„æ£€éªŒ)

# **ä¾‹5.3 æ£€éªŒé«˜å°”å¤«çƒåœºå¥³æ€§çƒå‘˜æ¯”ä¾‹æ˜¯å¦å› ä¿ƒé”€æ´»åŠ¨è€Œå‡é«˜** 
# 
# æŸé«˜å°”å¤«çƒåœºå»å¹´æ‰“çƒğŸŒğŸ»â€çš„äººå½“ä¸­æœ‰20%æ˜¯å¥³æ€§ï¼Œä¸ºäº†å¢åŠ å¥³æ€§çƒå‘˜çš„æ¯”ä¾‹ï¼Œè¯¥çƒåœºæ¨å‡ºäº†ä¸€é¡¹ä¿ƒé”€æ´»åŠ¨æ¥å¸å¼•æ›´å¤šçš„å¥³æ€§å‚åŠ é«˜å°”å¤«è¿åŠ¨ï¼Œåœ¨æ´»åŠ¨å®æ–½äº†1ä¸ªæœˆåï¼Œçƒåœºçš„ç ”ç©¶è€…æƒ³é€šè¿‡ç»Ÿè®¡åˆ†æç ”ç©¶ç¡®å®šé«˜å°”å¤«çƒåœºçš„å¥³æ€§çƒå‘˜æ¯”ä¾‹æ˜¯å¦ä¸Šå‡ï¼Œæ”¶é›†åˆ°äº†400ä¸ªéšæœºæ ·æœ¬ï¼Œå…¶ä¸­æœ‰100æ˜¯å¥³æ€§
# 
# 
# åˆ†æè¿‡ç¨‹ï¼š ç”±äºç ”ç©¶çš„æ˜¯å¥³æ€§çƒå‘˜æ‰€å çš„æ¯”ä¾‹æ˜¯å¦ä¸Šå‡ï¼Œå› æ­¤é€‰æ‹©ä¸Šä¾§æ£€éªŒæ¯”è¾ƒåˆé€‚,å¤‡æ‹©å‡è®¾æ˜¯æ¯”ä¾‹å¤§äº20%
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾

# $H_0:p \leqslant 0.20 \leftrightarrow  H_1ï¼šp > 0.20$:

# #### æ–¹æ³•1ï¼šç”¨statsmodels.stats.proportioné‡Œé¢çš„proportions_ztestå‡½æ•°è®¡ç®—ï¼ˆæ¨èï¼‰

# In[832]:


import numpy as np
from statsmodels.stats.proportion import proportions_ztest

count = 100
nobs = 400
p_0 = 0.2


# æ‰§è¡Œå•ä¸€æ ·æœ¬æ¯”ä¾‹æ£€éªŒ statsmodels.stats.proportion.proportions_ztest
z_statistic, p_value = proportions_ztest(count, nobs, value = p_0,alternative='larger',prop_var = value)
# æ³¨ï¼šstatsmodels.stats.proportion.proportions_ztest çš„å‡½æ•°æœ‰å‡ ä¸ªé—®é¢˜ï¼šè®²åœ¨ç¬¬å…«èŠ‚ä¹‹åè¯´æ˜ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…è¯·æŒç»­å…³æ³¨

# æ‰“å°ç»“æœ
print("zç»Ÿè®¡é‡ï¼š", z_statistic)
print("på€¼ï¼š", p_value)


# #### æ–¹æ³•2 ç”¨æ‰‹åŠ¨æ–¹å¼è®¡ç®—

# In[810]:


count = 100
nobs = 400
p_0 = 0.2


p_bar = count/nobs
p_0 = 0.2
n = 400

def calc_z_score(p_bar, p_0, n):
    z = (p_bar - p_0) / (p_0 * (1 - p_0) / n)**0.5
    return z

z = calc_z_score(p_bar, p_0, n)
p = stats.norm.sf(z)


# æ‰“å°ç»“æœ
print("zç»Ÿè®¡é‡ï¼š", z)
print("på€¼ï¼š", p)


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`P=0.0062 < 0.05`, æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœæ”¯æŒç‰¹å®šçš„ä¿ƒé”€æ´»åŠ¨èƒ½å¤Ÿæå‡è¯¥çƒåœºå¥³æ€§è¿åŠ¨å‘˜æ¯”ä¾‹çš„å¤‡åˆ™å‡è®¾ã€‚

# #### æ–¹å¼3 ç”¨ statsmodels.stats.proportionçš„binom_testå‡½æ•°è®¡ç®—På€¼

# In[811]:


import numpy as np
from statsmodels.stats.proportion import binom_test
count = 100
nobs = 400
p_0 = 0.2


# æ‰§è¡Œå•ä¸€æ ·æœ¬æ¯”ä¾‹æ£€éªŒ statsmodels.stats.proportion.binom_test

p = binom_test(count, nobs, prop = p_0,alternative='larger')

print("på€¼ï¼š", p)


# #### æ–¹å¼4 ç”¨scipy.statsçš„binom_testå‡½æ•°è®¡ç®—På€¼

# In[812]:


count = 100
nobs = 400
p_0 = 0.2


# æ‰§è¡Œå•ä¸€æ ·æœ¬æ¯”ä¾‹æ£€éªŒ scipy.stats.binom_test

p = scipy.stats.binom_test(x = count, n=nobs, p = p_0,alternative='greater')


print("på€¼ï¼š", p)


# #### ä¸€ä¸ªæ€»ä½“æ–¹å·®çš„å‡è®¾æ£€éªŒï¼ˆæŒ‡å®šæ–¹å·®å’Œæ ·æœ¬æ–¹å·®ï¼‰

# In[813]:


import numpy as np
from scipy import stats

def chi2test(sample_var, sample_num,sigma_square,side, alpha=0.05):
    '''
    å‚æ•°ï¼š
    sample_var--æ ·æœ¬æ–¹å·®
    sample_num--æ ·æœ¬å®¹é‡
    sigma_square--H0æ–¹å·®
    è¿”å›å€¼ï¼š
    pval
    '''
    chi_square =((sample_num-1)*sample_var)/(sigma_square)
    p_value = None
    if side == 'two-sided':
        p = stats.chi2(df=sample_num-1).cdf(chi_square)
        p_value = 2*np.min([p, 1-p])
    elif side == 'less':
        p_value = stats.chi2(df=sample_num-1).cdf(chi_square)
    elif side == 'greater':
        p_value = stats.chi2(df=sample_num-1).sf(chi_square)
    return chi_square,p_value


# **ä¾‹5.4 æ£€éªŒå…¬äº¤è½¦åˆ°ç«™æ—¶é—´çš„æ–¹å·®æ˜¯å¦æ¯”è§„å®šæ ‡å‡†å¤§** 
# 
# æŸå¸‚ä¸­å¿ƒè½¦ç«™ä¸ºè§„èŒƒåŒ–æå‡å¸‚æ°‘å¯¹äºå…¬äº¤è½¦åˆ°ç«™æ—¶é—´çš„æ»¡æ„åº¦ï¼Œå¯¹äºå…¬äº¤è½¦çš„åˆ°ç«™æ—¶é—´ç®¡ç†åšäº†è§„å®šï¼Œæ ‡å‡†æ˜¯åˆ°ç«™æ—¶é—´çš„æ–¹å·®ä¸è¶…è¿‡4ã€‚ä¸ºäº†æ£€éªŒæ—¶é—´çš„åˆ°ç«™æ—¶é—´çš„æ–¹å·®æ˜¯å¦è¿‡å¤§ï¼ŒéšæœºæŠ½å–äº†24è¾†å…¬äº¤è½¦çš„åˆ°ç«™æ—¶é—´ç»„æˆä¸€ä¸ªæ ·æœ¬ï¼Œå¾—åˆ°çš„æ ·æœ¬æ–¹å·®æ˜¯ $s^2=4.9$ï¼Œå‡è®¾åˆ°ç«™æ—¶é—´çš„æ€»ä½“åˆ†å¸ƒç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œè¯·åˆ†ææ€»ä½“æ–¹å·®æ˜¯å¦è¿‡å¤§ã€‚
# 
# åˆ†æè¿‡ç¨‹ï¼š ç”±äºç ”ç©¶çš„æ˜¯æ–¹å·®æ˜¯å¦è¿‡å¤§ï¼Œå› æ­¤é€‰æ‹©ä¸Šä¾§æ£€éªŒæ¯”è¾ƒåˆé€‚,å¤‡æ‹©å‡è®¾æ˜¯æ–¹å·®å¤§äº4
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾

# $H_0: \sigma^2 \leqslant 4 \leftrightarrow  H_1ï¼š\sigma^2 > 4$:

# In[814]:


chi_square,p_value = chi2test(sample_var = 4.9, sample_num = 24, sigma_square = 4,side='greater')
# ä¸Šä¾§æ£€éªŒ side='greater'

print("på€¼ï¼š", p_value)


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`P=0.2092 > 0.05`, æ— æ³•æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœä¸æ”¯æŒæ–¹å·®å˜å¤§çš„å¤‡åˆ™å‡è®¾ã€‚

# **ä¾‹5.5 æ£€éªŒæŸè€ƒè¯•ä¸­å¿ƒå‡çº§é¢˜åº“åè€ƒç”Ÿåˆ†æ•°çš„æ–¹å·®æ˜¯å¦æœ‰æ˜¾è‘—å˜åŒ–** 
# 
# æŸæ•°æ®åˆ†æå¸ˆè®¤è¯è€ƒè¯•æœºæ„CDAè€ƒè¯•ä¸­å¿ƒï¼Œå†å²ä¸Šçš„æŒè¯äººè€ƒè¯•åˆ†æ•°çš„æ–¹å·®ä¸º $\sigma^2=100$ï¼Œç°åœ¨å‡çº§äº†é¢˜åº“ï¼Œè¯¥è€ƒè¯•ä¸­å¿ƒå¸Œæœ›æ–°å‹è€ƒé¢˜çš„æ–¹å·®ä¿æŒåœ¨åŸæœ‰æ°´å¹³ä¸Šï¼Œä¸ºäº†ç ”ç©¶è¯¥é—®é¢˜ï¼Œæ”¶é›†åˆ°äº†30ä»½æ–°è€ƒé¢˜çš„è€ƒåˆ†ç»„æˆçš„æ ·æœ¬ï¼Œæ ·æœ¬æ–¹å·®æ˜¯$\sigma^2=152$ï¼Œåœ¨ $\alpha=0.05$çš„æ˜¾è‘—æ€§æ°´å¹³ä¸‹è¿›è¡Œå‡è®¾æ£€éªŒã€‚
# 
# 
# åˆ†æè¿‡ç¨‹ï¼šç”±äºç›®æ ‡æ˜¯å¸Œæœ›è€ƒè¯•åˆ†æ•°çš„æ–¹å·®ä¿æŒåŸæœ‰æ°´å¹³ï¼Œå› æ­¤é€‰æ‹©åŒä¾§æ£€éªŒ
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾
# 
# $H_0: \sigma^2 =100 \leftrightarrow  H_1ï¼š\sigma^2 \neq 100$:

# In[815]:


chi_square,p_value = chi2test(sample_var = 152, sample_num = 30, sigma_square = 100,side='two-sided')
# åŒä¾§æ£€éªŒ side='two-sided'
print("på€¼ï¼š", p_value)


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`P=0.0721 > 0.05`, æ•…æ— æ³•æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ä¸æ”¯æŒæ–¹å·®å‘ç”Ÿäº†å˜åŒ–çš„å¤‡åˆ™å‡è®¾ã€‚

# ### ä¸¤æ€»ä½“å‡å€¼ä¹‹å·®çš„å‡è®¾æ£€éªŒ ç‹¬ç«‹æ ·æœ¬

# **ä¾‹5.6ï¼ˆæ•°æ®ï¼šdrug.txtï¼‰ æ£€éªŒæŸè¯ç‰©åœ¨å®éªŒç»„çš„æŒ‡æ ‡æ˜¯å¦ä½äºå¯¹ç…§ç»„**
# 
# ä¸ºæ£€æµ‹æŸç§è¯ç‰©å¯¹æƒ…ç»ªçš„å½±å“ï¼Œå¯¹å®éªŒç»„çš„100åæœè¯è€…å’Œå¯¹ç…§ç»„çš„150åéæœè¯è€…è¿›è¡Œå¿ƒç†æµ‹è¯•ï¼Œå¾—åˆ°ç›¸åº”çš„æŸæŒ‡æ ‡ã€‚éœ€è¦æ£€éªŒå®éªŒç»„æŒ‡æ ‡çš„æ€»ä½“å‡å€¼$\mu_1$æ˜¯å¦å¤§äºå¯¹ç…§ç»„çš„æŒ‡æ ‡çš„æ€»ä½“å‡å€¼$\mu_2$ã€‚è¿™é‡Œå‡å®šä¸¤ä¸ªæ€»ä½“ç‹¬ç«‹åœ°æœä»æ­£æ€åˆ†å¸ƒã€‚ç›¸åº”çš„å‡è®¾æ£€éªŒé—®é¢˜ä¸º:

# åˆ†æè¿‡ç¨‹ï¼šç”±äºç›®æ ‡æ˜¯æ£€éªŒå®éªŒç»„æŒ‡æ ‡çš„æ€»ä½“å‡å€¼$\mu_1$æ˜¯å¦å¤§äºå¯¹ç…§ç»„çš„æŒ‡æ ‡çš„æ€»ä½“å‡å€¼$\mu_2$ï¼Œå› æ­¤é€‰æ‹©ä¸Šä¾§æ£€éªŒ
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾
# 
# $H_0: \mu_1 \leqslant \mu_2 \leftrightarrow  H_1ï¼š\mu_1 > \mu_2$:

# In[820]:


data = pd.read_table("./t-data/drug.txt",sep = ' ') 


# In[822]:


data.sample(5)


# In[823]:


a = data[data['id']==1]['ah']
b = data[data['id']==2]['ah']


# In[824]:


'''
H0: å®éªŒç»„çš„å‡å€¼ç­‰äºå¯¹ç…§ç»„
H1: å®éªŒç»„çš„å‡å€¼å¤§äºå¯¹ç…§ç»„
'''
t, pval = scipy.stats.ttest_ind(a,b,alternative = 'greater')
# é€‰æ‹©ä¸Šä¾§æ£€éªŒ æ‰€ä»¥è¿™é‡Œ alternative = 'greater'
print(t,pval)


# **ç»“è®ºï¼š** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`p = 0.1816 > 0.05`,æ— æ³•æ‹’ç»H0ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœæ— æ³•æ”¯æŒå®éªŒç»„å‡å€¼å¤§äºå¯¹ç…§ç»„çš„å¤‡åˆ™å‡è®¾ã€‚

# #### ä¸¤æ€»ä½“å‡å€¼ä¹‹å·®çš„å‡è®¾æ£€éªŒ(é…å¯¹æ ·æœ¬)

# **ä¾‹5.7(æ•°æ®: diet.txt) æ£€éªŒå‡è‚¥å‰åçš„è´¨é‡æ˜¯å¦æœ‰æ˜¾è‘—æ€§å·®å¼‚ï¼ˆæ˜¯å¦æœ‰å‡è‚¥æ•ˆæœï¼‰** 
# 
# è¿™é‡Œæœ‰ä¸¤åˆ—50å¯¹å‡è‚¥æ•°æ®ã€‚å…¶ä¸­ä¸€åˆ—æ•°æ®(å˜é‡åbefore)æ˜¯å‡è‚¥å‰çš„é‡é‡ï¼Œå¦ä¸€åˆ—(å˜é‡åafter)æ˜¯å‡è‚¥åçš„é‡é‡(å•ä½: å…¬æ–¤)ï¼Œäººä»¬å¸Œæœ›æ¯”è¾ƒ50ä¸ªäººåœ¨å‡è‚¥å‰å’Œå‡è‚¥åçš„é‡é‡ã€‚
# 
# åˆ†æè¿‡ç¨‹ï¼šè¿™é‡Œä¸èƒ½ç”¨å‰é¢çš„ç‹¬ç«‹æ ·æœ¬å‡å€¼å·®çš„æ£€éªŒï¼Œè¿™æ˜¯å› ä¸ºä¸¤ä¸ªæ ·æœ¬å¹¶ä¸ç‹¬ç«‹ã€‚æ¯ä¸€ä¸ªäººå‡è‚¥åçš„é‡é‡éƒ½å’Œè‡ªå·±å‡è‚¥å‰çš„é‡é‡æœ‰å…³ï¼Œä½†ä¸åŒäººä¹‹é—´å´æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åº”è¯¥ç”¨é…å¯¹æ ·æœ¬æ£€éªŒã€‚åŒæ—¶ï¼Œç”±äºç ”ç©¶çš„æ˜¯å‡è‚¥å‰åçš„é‡é‡å˜åŒ–ï¼ŒæœŸæœ›å‡è‚¥å‰çš„é‡é‡å¤§äºå‡è‚¥åçš„é‡é‡ï¼Œæ‰€ä»¥å¤‡æ‹©å‡è®¾æ˜¯æœŸæœ›å‡è‚¥å‰çš„é‡é‡å¤§äºå‡è‚¥åçš„é‡é‡
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾ï¼š
# 
# 
# $H_0: \mu_1 = \mu_2 \leftrightarrow  H_1ï¼š\mu_1 > \mu_2$:

# In[45]:


data = pd.read_table("./t-data/diet.txt",sep = ' ')


# In[46]:


data.sample(5)#.to_markdown()


# In[63]:


d = data['before'] - data['after']


# In[64]:


d_bar = ( d).sum()/len(data)


# In[65]:


s_d = np.sqrt(((d -d_bar)**2).sum()/(len(data)-1))
s_d


# In[69]:


t = (d_bar)/(s_d/np.sqrt(len(data)))
t


# In[70]:


scipy.stats.t.sf(t, len(data)-1)


# In[829]:


a = data['before']
b = data['after']


# In[799]:


stats.ttest_rel(a, b,alternative = 'greater')


# **ç»“è®º** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`p = 0.0007 < 0.05`,æ•…åº”è¯¥æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœå€¾å‘æ”¯æŒå‡è‚¥å‰åçš„é‡é‡ä¹‹å·®å¤§äºé›¶ï¼ˆå³å‡è‚¥å‰é‡é‡å¤§äºå‡è‚¥åï¼Œä¹Ÿå°±æ˜¯æœ‰å‡è‚¥æ•ˆæœï¼‰çš„å¤‡åˆ™å‡è®¾ã€‚

# #### ä¸¤æ€»ä½“æ¯”ä¾‹ä¹‹å·®çš„å‡è®¾æ£€éªŒ

# In[800]:


import numpy as np
import scipy.stats as stats

def proportion_test(p1, p2, n1, n2, side='two-sided'):
    """
    å‚æ•°ï¼š
    p1: æ ·æœ¬1çš„æ¯”ä¾‹
    p2: æ ·æœ¬2çš„æ¯”ä¾‹
    n1: æ ·æœ¬1çš„æ•°é‡
    n2: æ ·æœ¬2çš„æ•°é‡
    side: å‡è®¾æ£€éªŒçš„æ–¹å‘ï¼Œå¯é€‰'two-sided'ï¼ˆåŒä¾§æ£€éªŒï¼Œé»˜è®¤ï¼‰, 'greater'ï¼ˆå³ä¾§æ£€éªŒï¼‰, 'less'ï¼ˆå·¦ä¾§æ£€éªŒï¼‰

    è¿”å›å€¼ï¼š
    z_value: Zç»Ÿè®¡é‡çš„å€¼
    p_value: å¯¹åº”çš„på€¼
    """
    p = (p1 * n1 + p2 * n2) / (n1 + n2)
    se = np.sqrt(p * (1 - p) * (1 / n1 + 1 / n2))
    z_value = (p1 - p2) / se

    if side == 'two-sided':
        p_value = 2 * (1 - stats.norm.cdf(np.abs(z_value)))
    elif side == 'greater':
        p_value = 1 - stats.norm.cdf(z_value)
    elif side == 'less':
        p_value = stats.norm.cdf(z_value)
    else:
        raise ValueError("Invalid side value. Must be 'two-sided', 'greater', or 'less'.")

    return z_value, p_value


# **ä¾‹5.8 æ£€éªŒä¸åŒä¿é™©å®¢æˆ·çš„ç´¢èµ”ç‡æ˜¯å¦å­˜åœ¨å·®å¼‚** 
# 
# æŸä¿é™©å…¬å¸æŠ½å–äº†å•èº«ä¸å·²å©šå®¢æˆ·çš„æ ·æœ¬ï¼Œè®°å½•äº†ä»–ä»¬åœ¨ä¸€æ®µæ•°æ®å†…çš„ç´¢èµ”æ¬¡æ•°ï¼Œè®¡ç®—äº†ç´¢èµ”ç‡ï¼Œç°åœ¨éœ€è¦æ£€éªŒä¸¤ç§ä¿é™©å®¢æˆ·çš„ç´¢èµ”ç‡æ˜¯å¦å­˜åœ¨å·®å¼‚
# 
# åˆ†æè¿‡ç¨‹ï¼šç”±äºç›®æ ‡æ¯”ä¾‹æ˜¯å¦æœ‰å·®å¼‚ï¼Œå› æ­¤é€‰æ‹©æ¯”ä¾‹ä¹‹å·®çš„åŒä¾§æ£€éªŒ
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾
# 
# $H_0: p_1 = p_2 \leftrightarrow  H_1ï¼šp_1 \neq p_2$:

# In[774]:


p1 = 0.14
p2 = 0.09
n1 = 250
n2 = 300

z_value, p_value = proportion_test(p1, p2, n1, n2, side='two-sided')
# é€‰æ‹©åŒä¾§æ£€éªŒ alternative = 'two-sided'

print("Z_value:", z_value)
print("p_value:", p_value)


# **ç»“è®º** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`p = 0.0648 > 0.05`,æ•…åº”è¯¥æ‹’ç»åŸå‡è®¾ã€‚å…·ä½“æ¥è¯´å°±æ˜¯è¯¥ç»“æœå€¾å‘æ”¯æŒä¸¤ç§ä¿é™©å®¢æˆ·çš„ç´¢èµ”ç‡å­˜åœ¨å·®å¼‚çš„å¤‡åˆ™å‡è®¾ã€‚

# ####  ä¸¤æ€»ä½“æ–¹å·®ä¹‹æ¯”çš„å‡è®¾æ£€éªŒ

# In[683]:


import numpy as np
from scipy import stats

def f_test_by_s_square(n1, n2, s1_square,s2_square, side ='two-sided'):
    """
    å‚æ•°
    n1 :æ ·æœ¬1çš„æ•°é‡
    n2 :æ ·æœ¬2çš„æ•°é‡
    s1_square:æ ·æœ¬1çš„æ–¹å·®
    s2_square:æ ·æœ¬2çš„æ–¹å·®
    # 
    # F_value :Fç»Ÿè®¡é‡çš„å€¼
    # p_value :å¯¹åº”çš„på€¼
    """
    F_value = s1_square/s2_square
    F = stats.f(dfn = n1-1, dfd = n2-1)
    if side=='two-sided':
        print("two-sided")
        p_value = 2*min(F.cdf(F_value), 1-F.cdf(F_value))
        return F_value,p_value
    elif  side=='greater':
        print("greater")
        p_value = 1-F.cdf(F_value)
        return F_value,p_value


# **ä¾‹5.9 æ£€éªŒä¸åŒå…¬äº¤å…¬å¸çš„æ ¡è½¦åˆ°è¾¾æ—¶é—´çš„æ–¹å·®æ˜¯å¦æœ‰å·®å¼‚** 
# 
# æŸå­¦æ ¡çš„æ ¡è½¦åˆåŒåˆ°æœŸï¼Œå…ˆéœ€è¦åœ¨Aã€Bä¸¤ä¸ªæ ¡è½¦ä¾›åº”å…¬å¸ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œæ‰æœ‰åˆ°è¾¾æ—¶é—´çš„æ–¹å·®ä½œä¸ºè¡¡é‡æœåŠ¡è´¨é‡çš„æ ‡å‡†ï¼Œè¾ƒä½æ–¹å·®è¯´æ˜æœåŠ¡è´¨é‡ç¨³å®šä¸”æ°´å¹³è¾ƒé«˜ï¼Œå¦‚æœæ–¹å·®ç›¸ç­‰ï¼Œåˆ™ä¼šé€‰æ‹©ä»·æ ¼æ›´ä½çš„å…¬å¸ï¼Œï¼Œå¦‚æœæ–¹å·®ä¸ç­‰ï¼Œåˆ™ä¼˜å…ˆè€ƒè™‘æ–¹å·®æ›´ä½çš„å…¬å¸ã€‚
# ç°æ”¶é›†åˆ°äº†Aå…¬å¸çš„26æ¬¡åˆ°è¾¾æ—¶é—´ç»„æˆä¸€ä¸ªæ ·æœ¬ï¼Œæ–¹å·®68ï¼ŒBå…¬å¸16æ¬¡åˆ°è¾¾æ—¶é—´ç»„æˆä¸€ä¸ªæ ·æœ¬ï¼Œæ–¹å·®æ˜¯30ï¼Œè¯·æ£€éªŒABä¸¤ä¸ªå…¬å¸çš„åˆ°è¾¾æ—¶é—´æ–¹å·®ã€‚
# 
# 
# åˆ†æè¿‡ç¨‹ï¼šç”±äºç›®æ ‡æ˜¯å¸Œæœ›çš„æ–¹å·®ä¿æŒåŸæœ‰æ°´å¹³ï¼Œå› æ­¤é€‰æ‹©åŒä¾§æ£€éªŒã€‚ä¸¤æ€»ä½“æ–¹å·®ä¹‹æ¯”ç”¨Fæ£€éªŒ,å°†æ–¹å·®è¾ƒå¤§çš„Aè§†ä¸ºæ€»ä½“1
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾
# 
# $H_0: \sigma_1 = \sigma_2  \leftrightarrow  H_1ï¼š \sigma_1 \neq \sigma_2 $:

# In[775]:


f_statistic , p_value= f_test_by_s_square(n1=26, n2=16,s1_square=78,s2_square=20,side='two-sided')
# é€‰æ‹©åŒä¾§æ£€éªŒæ‰€ä»¥side='two-sided'
# æ‰“å°æ£€éªŒç»“æœ
print("F statistic:", f_statistic)
print("p-value:", p_value)


# **ç»“è®º** é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œ`p = 0.0083 < 0.05`,æ•…æ‹’ç»åŸå‡è®¾ã€‚ç»“æœå€¾å‘æ”¯æŒABä¸¤ä¸ªå…¬å¸çš„åˆ°è¾¾æ—¶é—´æ–¹å·®å­˜åœ¨å·®å¼‚çš„å¤‡åˆ™å‡è®¾ã€‚

# **ä¾‹5.10 æ£€éªŒä¿®å®ŒPythonè¯¾ç¨‹çš„å­¦ç”Ÿæ˜¯å¦æ¯”ä¿®å®Œæ•°æ®åº“è¯¾ç¨‹çš„å­¦ç”Ÿè€ƒCDAçš„æˆç»©æ–¹å·®æ›´å¤§** 
# 
# æŸé«˜æ ¡æ•°æ®ç§‘å­¦ä¸“ä¸šçš„å­¦ç”Ÿï¼Œä¿®å®Œä¸€é—¨æ•°æ®åº“è¯¾ç¨‹çš„41åå­¦ç”Ÿè€ƒCDAçš„æ–¹å·®$s^2=120$ï¼Œä¿®å®ŒPythonè¯¾ç¨‹çš„31åå­¦ç”Ÿè€ƒCDAçš„æ–¹å·®æ˜¯$s^2=80$ï¼Œè¿™äº›æ•°æ®æ˜¯å¦è¡¨æ˜ï¼Œä¿®å®Œæ•°æ®åº“çš„å­¦ç”Ÿè¦æ¯”ä¿®å®ŒPythonçš„å­¦ç”ŸCDAæˆç»©çš„æ–¹å·®æ›´å¤§ï¼Ÿ
# 
# 
# åˆ†æè¿‡ç¨‹ï¼šç”±äºç›®æ ‡æ˜¯å¸Œæœ›ä¿®å®ŒPythonçš„å­¦ç”ŸCDAæˆç»©çš„æ–¹å·®æ›´å¤§ï¼Œå› æ­¤é€‰æ‹©ä¸Šä¾§æ£€éªŒã€‚ä¸¤æ€»ä½“æ–¹å·®ä¹‹æ¯”ç”¨Fæ£€éªŒ,å°†æ–¹å·®è¾ƒå¤§çš„æ•°æ®åº“è¯¾ç¨‹çš„è€ƒè¯•æˆç»©è§†ä¸ºæ€»ä½“1
# 
# äºæ˜¯æˆ‘ä»¬æœ‰äº†åŸå‡è®¾å’Œå¤‡æ‹©å‡è®¾
# 
# $H_0: \sigma_1 < \sigma_2  \leftrightarrow  H_1ï¼š \sigma_1 \geqslant \sigma_2 $:

# In[801]:


f_statistic , p_value= f_test_by_s_square(n1=41, n2=31,s1_square=120,s2_square=80,side='greater')# æ‰“å°æ£€éªŒç»“æœ
# é€‰æ‹©ä¸Šä¾§æ£€éªŒæ‰€ä»¥side='greater'
print("F statistic:", f_statistic)
print("p-value:", p_value)


# **ç»“è®º**  é€‰æ‹©æ˜¾è‘—æ€§æ°´å¹³ 0.05 çš„è¯ï¼Œp = 0.1256 > 0.05ï¼Œæ•…æ— æ³•åŸå‡è®¾ã€‚ç»“æœæ— æ³•æ”¯æŒä¿®å®Œæ•°æ®åº“çš„å­¦ç”Ÿè¦æ¯”ä¿®å®ŒPythonçš„å­¦ç”ŸCDAæˆç»©çš„æ–¹å·®æ›´å¤§çš„å¤‡åˆ™å‡è®¾ã€‚

# #### è¡¥å……è¯´æ˜

# In[ ]:





# In[781]:


import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import scipy.stats as stats

# Generate random data
np.random.seed(0)
data = np.random.normal(loc=0, scale=1, size=1000)

# Plot Normal Probability Plot
plt.subplot(2, 2, 1)
stats.probplot(data, dist="norm", plot=plt)
plt.title("Normal Probability Plot")

# Plot QQ Plot
plt.subplot(2, 2, 2)
stats.probplot(data, dist="norm", plot=plt)
plt.title("QQ Plot")

# Plot PP Plot
plt.subplot(2, 2, 3)
stats.probplot(data, dist="norm", plot=plt, fit=True)
plt.title("PP Plot")

# Plot Boxplot
plt.subplot(2, 2, 4)
sns.boxplot(data)
plt.title("Boxplot")

plt.tight_layout()
plt.show()


# In[782]:


import numpy as np
import scipy.stats as stats

# ç”Ÿæˆéšæœºæ•°
np.random.seed(0)
data = np.random.normal(loc=0, scale=1, size=1000)

# è¿›è¡ŒKSæ£€éªŒ
ks_statistic, p_value = stats.kstest(data, 'norm')

# æ‰“å°ç»“æœ
print("KS statistic:", ks_statistic)
print("p-value:", p_value)


# å‡½æ•°å°†è¿”å›KSç»Ÿè®¡é‡å’Œpå€¼ã€‚KSç»Ÿè®¡é‡è¡¨ç¤ºè§‚å¯Ÿåˆ°çš„æ•°æ®ä¸æŒ‡å®šåˆ†å¸ƒä¹‹é—´çš„æœ€å¤§å·®å¼‚ï¼Œpå€¼è¡¨ç¤ºè§‚å¯Ÿåˆ°çš„æ•°æ®ä¸æŒ‡å®šåˆ†å¸ƒä¸€è‡´çš„æ¦‚ç‡ã€‚
# 
# è¯·æ³¨æ„ï¼ŒKSæ£€éªŒå‡è®¾æ•°æ®ä¸æŒ‡å®šåˆ†å¸ƒå®Œå…¨ä¸€è‡´ã€‚å¦‚æœpå€¼å°äºæ˜¾è‘—æ€§æ°´å¹³ï¼ˆé€šå¸¸ä¸º0.05ï¼‰ï¼Œåˆ™å¯ä»¥æ‹’ç»è¯¥å‡è®¾ï¼Œå³æ•°æ®ä¸æœä»æŒ‡å®šçš„åˆ†å¸ƒã€‚

# åŸå‡è®¾æ˜¯æœä»ï¼Œå¤‡æ‹©å‡è®¾æ˜¯ä¸æœä»
